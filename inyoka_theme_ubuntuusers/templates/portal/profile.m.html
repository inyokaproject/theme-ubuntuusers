{#
    portal/profile.m.html
    ~~~~~~~~~~~~~~~~~~~~~

    This page shows a user's profile.

    :copyright: (c) 2007-2017 by the Inyoka Team, see AUTHORS for more details.
    :license: BSD, see LICENSE for more details.
#}
{%- extends 'portal/overall.m.html' %}

{% import 'macros.html' as macros %}

{% macro show_item(label, item, link=None) %}
  {%- if user[item] -%}
    <dt>{{ label }}</dt>
      <dd>
        {%- if link -%}
          <a href="{{ link|e }}">{{ user[item]|e }}</a>
        {%- else -%}
          {{ user[item]|e }}
        {%- endif -%}
      </dd>
  {%- endif -%}
{% endmacro %}

{% macro show_private_item(label, item) %}
  {%- if user[item] and user.settings['show_'+item] -%}
    <dt>{{ label }}</dt>
      <dd>{{ user[item]|e }}</dd>
  {%- elif user[item] and REQUEST.user.has_perm('portal.change_user') -%}
    <dt class="hidden">{{ label }}</dt>
      <dd class="hidden">{{ user[item]|e }}</dd>
  {%- endif -%}
{% endmacro %}

{% block content %}
  <h3>Benutzer „{{ user.username|e }}”</h3>
  {%- if user in (User.objects.get_system_user(), User.objects.get_anonymous_user()) %}
    {{ user.username|e }} ist ein Systembenutzer.
  {%- elif user.is_deleted or user.is_banned %}
    {{ user.username|e }} ist nicht mehr verfügbar.
  {%- else %}
    {{ macros.add_user_avatar(user) }}
    <dl class="userinfo">
      {{ show_private_item('E-Mail-Adresse', 'email') }}
      {{ show_item('GPG-Schlüssel', 'gpgkey') }}
      {{ show_private_item('Jabber', 'jabber') }}
      {{ show_item('Webseite', 'website', user.website) }}
      {{ show_item('Launchpad', 'launchpad', user.launchpad_url) }}
      {{ show_item('Wohnort', 'location') }}
      {{ show_item('Anmeldungsdatum', 'date_joined') }}
      {{ show_item('Beiträge', 'post_count', href('forum', 'author', user.username)) }}
      {{ show_item('Signatur', 'signature') }}
      <dt>Kontakt</dt>
        <dd><a href="{{ user|url('privmsg') }}">Private Nachricht</a></dd>
      {% if groups -%}
        <dt>Gruppenmitgliedschaften</dt>
          <dd>
            {%- for group in groups -%}
              <a href="{{ group|url }}"{% if not group.is_public %} class="hidden"{% endif %}>{{ group.name|e }}</a>
              {%- if not loop.last %}, {% endif %}
            {%- endfor -%}
          </dd>
      {%- endif %}
    </dl>
  {%- endif %}
{% endblock %}
