{#
    wiki/page.html
    ~~~~~~~~~~~~~~

    This is the base layout for all wiki detail pages except of partial
    templates (prefixed with an underscore)

    :copyright: (c) 2007-2015 by the Inyoka Team, see AUTHORS for more details.
    :license: BSD, see LICENSE for more details.
#}
{%- extends 'overall.html' %}

{%- if page %}
  {% set breadcrumbs = [] %}
  {% for part in page.title.split('/') %}
    {% if loop.first %}
      {% set link = href('wiki', part) %}
    {% else %}
      {% set link = link + '/' + part %}
    {% endif %}
    {% do breadcrumbs.append((part, link)) %}
  {% endfor %}
  {% for breadcrumb in breadcrumbs[::-1] %}
    {% do BREADCRUMB.append(breadcrumb[0], breadcrumb[1], True) %}
  {% endfor %}
{%- endif %}
{% do BREADCRUMB.append(_('Wiki'), href('wiki'), True) %}
{% set styles = styles|default([]) + ['wiki', 'highlight'] %}
{% set active_app = 'wiki' %}

{% set navi_type  = 'both' %}

{% block sidebar %}
  <div class="container">
    <h3 class="navi_wiki">{% trans %}Wiki{% endtrans %}</h3>
    <ul>
      <li><a href="{{ href('wiki', 'Wiki', 'Index') }}">{% trans %}Index{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'wiki', 'recentchanges') }}">{% trans %}Recent changes{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Neue_Artikel') }}">{% trans %}List of new articles{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki') }}">{% trans %}Overview{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'FAQ_-_häufig_gestellte_Fragen') }}">{% trans %}FAQ{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Benutzung') }}">{% trans %}Usage{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Kategorien') }}">{% trans %}Category{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'wiki', 'tagcloud') }}">{% trans %}Tag Cloud{% endtrans %}</a></li>
    </ul>
    <h3 class="navi_join">{% trans %}Participation{% endtrans %}</h3>
    <ul>
      <li><a href="{{ href('wiki', 'wiki', 'create') }}">{% trans %}Create a wiki article{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'HowTo') }}">{% trans %}Create a Howto{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Referenz') }}">{% trans %}Wiki Reference{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Syntax') }}">{% trans %}Wiki Syntax{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Baustelle') }}">{% trans %}Sites under construction{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Artikelideen') }}">{% trans %}Article Ideas{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'ungetestet') }}">{% trans %}Untested Articles{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Vorlagen', 'Ausbaufähig', 'a', 'backlinks') }}">{% trans %}Expandable Articles{% endtrans %}</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Vorlagen', 'Fehlerhaft', 'a', 'backlinks') }}">{% trans %}Incorrect Articles{% endtrans %}</a></li>
      <li><a href="{{ href('forum', 'forum', 'wiki') }}">{% trans %}Around the Wiki{% endtrans %}</a></li>
    </ul>
    {%- if can and can.manage %}
    <h3 class="navi_config">{% trans %}Configuration{% endtrans %}</h3>
    <ul>
      <li><a href="{{ page|url('rename') }}">{% trans %}Rename page{% endtrans %}</a></li>
      {%- if can.delete %}
        <li><a href="{{ page|url('delete') }}">{% trans %}Delete page{% endtrans %}</a></li>
      {%- endif %}
        {%- if page.name.startswith('Baustelle/Verlassen') %}
          <li><a href="{{ page|url('mv_baustelle') }}">{% trans %}Mark page as “under construction”{% endtrans %}</a></li>
        {%- elif page.name.startswith('Baustelle') %}
          <li><a href="{{ page|url('mv_discontinued') }}">{% trans %}Move page to “discontinued”{% endtrans %}</a></li>
          <li><a href="{{ page|url('mv_back') }}">{% trans %}Move page back to the wiki{% endtrans %}</a></li>
        {%- else %}
          <li><a href="{{ page|url('mv_baustelle') }}">{% trans %}Mark page as “under construction”{% endtrans %}</a></li>
      {%- endif %}
      <li><a href="{{ page|url('backlinks') }}">{% trans %}Show backlinks{% endtrans %}</a></li>
      <li><a href="{{ page|url('attachments') }}">{% trans %}Manage attachments{% endtrans %}</a></li>
      <li><a href="{{ page|url('discussion') }}">{% trans %}Link discussion{% endtrans %}</a></li>
      <li>{% trans %}Export{% endtrans %}<ul>
        <li><a href="{{ page|url('export', format='meta') }}">{% trans %}Metadata{% endtrans %}</a></li>
        <li><a href="{{ page|url('export', format='raw') }}">{% trans %}Raw{% endtrans %}</a></li>
        <li><a href="{{ page|url('export', format='html') }}">{% trans %}HTML{% endtrans %}</a></li>
        <li><a href="{{ page|url('export', format='ast') }}">{% trans %}AST{% endtrans %}</a></li>
      </ul></li>
  {%- endif %}
  </ul>
  </div>
{% endblock %}

{% block tabbar %}
  {%- if can and can.read %}
    <ul>
      {%- for action_, title in (
        ('show', _('Article')),
        ('edit', _('Edit')),
        ('log', _('Log')),
      ) %}
        {%- if action_ != 'edit' or (action_ == 'edit' and (can.edit or USER.is_anonymous)) %}
        <li><a href="{{ page|url(action_) }}"{% if action == action_ %} class="active"{% endif %}>{{ title }}</a></li>
        {%- endif %}
      {%- endfor %}
      <li{% if not page.topic %} class="disabled"{% endif %}>
        <a href="{{ page.topic and page.topic|url('last_post') or href('forum', 'new_discussion', page.title) }}">{% trans %}Discussion{% endtrans %}</a>
      </li>
      {%- if is_subscribed %}
        <li><a href="{{ page|url('unsubscribe') }}">{% trans %}Unsubscribe{% endtrans %}</a></li>
      {%- else %}
        <li><a href="{{ page|url('subscribe') }}">{% trans %}Subscribe{% endtrans %}</a></li>
      {%- endif %}
    </ul>
  {%- endif %}
{% endblock %}

{% block content %}
  {%- block wiki_content %}

  {%- endblock %}
{%- endblock %}
